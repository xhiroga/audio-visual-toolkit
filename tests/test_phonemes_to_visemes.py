from audio_visual_toolkit.phonemes_to_visemes import (
    phonemes_ja_jp_to_mpeg4_visemes,
    allophonize,
)


def test_allophonize_1():
    input = [
        ("0", "31694820", "sil"),
        ("31694820", "32331790", "n"),
        ("32331790", "33349480", "a"),
        ("33349480", "34229170", "N"),
        ("34229170", "34411100", "d"),
        ("34411100", "34880810", "o"),
    ]
    expected = [
        ("0", "31694820", "sil"),
        ("31694820", "32331790", "n"),
        ("32331790", "33349480", "a"),
        ("33349480", "34229170", "n"),
        ("34229170", "34411100", "d"),
        ("34411100", "34880810", "o"),
    ]
    actual = allophonize(input)
    assert actual == expected, f"{actual=}"


def test_allophonize_2():
    input = [
        ("0", "31694820", "sil"),
        ("31694820", "32331790", "a"),
        ("32331790", "33349480", "N"),
        ("33349480", "34229170", "p"),
        ("34229170", "34411100", "a"),
        ("34411100", "34880810", "N"),
    ]
    expected = [
        ("0", "31694820", "sil"),
        ("31694820", "32331790", "a"),
        ("32331790", "33349480", "m"),
        ("33349480", "34229170", "p"),
        ("34229170", "34411100", "a"),
        ("34411100", "34880810", "n"),
    ]
    actual = allophonize(input)
    assert actual == expected, f"{actual=}"


def test_p2v_1():
    phonemes = [
        ("0", "27770490", "sil"),
        ("27770490", "28734690", "i"),
        ("28734690", "29901050", "k"),
        ("29901050", "30523380", "u"),
        ("30523380", "30772310", "r"),
        ("30772310", "31694820", "a"),
    ]
    expected = [
        ("0", "27770490", "sil"),
        ("27770490", "28734690", "I"),
        ("28734690", "29901050", "kk"),
        ("29901050", "30523380", "U"),
        ("30523380", "30772310", "nn"),
        ("30772310", "31694820", "aa"),
    ]
    visemes = phonemes_ja_jp_to_mpeg4_visemes(phonemes)
    assert visemes == expected, f"actual: {visemes}"
